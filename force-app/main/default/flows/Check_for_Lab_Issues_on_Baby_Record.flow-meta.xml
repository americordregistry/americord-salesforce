<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Send email to CS Team that we need to contact the client to confirm use of CT.</description>
        <name>Send_Email_To_CS_Team</name>
        <label>Send Email To CS Team</label>
        <locationX>50</locationX>
        <locationY>350</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <elementReference>varTEmailAddressForClientServices</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <elementReference>varTEmailSubject</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <elementReference>textTEmailBody</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sendRichBody</name>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>relatedRecordId</name>
            <value>
                <elementReference>Get_Baby_Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>emailSimple</nameSegment>
    </actionCalls>
    <apiVersion>56.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <decisions>
        <description>Determine if there is an issue with the CT sample and we need to message the CS team.</description>
        <name>Is_There_An_Issue_With_CT</name>
        <label>Is There An Issue With CT?</label>
        <locationX>182</locationX>
        <locationY>242</locationY>
        <defaultConnectorLabel>No Issue</defaultConnectorLabel>
        <rules>
            <name>There_Is_An_Issue</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Baby_Record.Get_CT_from_Placenta__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varBoolGetCTFromPlacentaCurrentValue</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>varBoolGetCTFromPlacentaPriorValue</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_Email_To_CS_Team</targetReference>
            </connector>
            <label>There Is An Issue</label>
        </rules>
    </decisions>
    <description>Check for lab issues on the baby record.</description>
    <environments>Default</environments>
    <formulas>
        <description>Formula that can be used for linking to the baby record.</description>
        <name>formTBabyRecordLink</name>
        <dataType>String</dataType>
        <expression>LEFT({!$Api.Partner_Server_URL_550}, FIND( &apos;/services&apos;, {!$Api.Partner_Server_URL_550}))&amp;{!Get_Baby_Record.Id}</expression>
    </formulas>
    <formulas>
        <description>URL for the Lab</description>
        <name>formTLabRecordLink</name>
        <dataType>String</dataType>
        <expression>LEFT({!$Api.Partner_Server_URL_550}, FIND( &apos;/services&apos;, {!$Api.Partner_Server_URL_550}))&amp;{!Get_Baby_Record.Lab__c}</expression>
    </formulas>
    <interviewLabel>Check for Lab Issues on Baby Record {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Check for Lab Issues on Baby Record</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>Get the Baby Record using the passed in ID.</description>
        <name>Get_Baby_Record</name>
        <label>Get Baby Record</label>
        <locationX>182</locationX>
        <locationY>134</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Is_There_An_Issue_With_CT</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varBabyRecordID</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Baby__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>56</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Baby_Record</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <textTemplates>
        <description>Email Body for sending to CS team.</description>
        <name>textTEmailBody</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;CS Team,&lt;/p&gt;&lt;p&gt;There is an issue with the CT sample. We will need to contact the client and determine if they would like us to use the cord tissue from the placenta sample.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Client ID: &lt;a href=&quot;https://americord--uat.sandbox.lightning.force.com/builder_platform_interaction/%7B!formTBabyRecordLink%7D&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot; style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;{!Get_Baby_Record.Kit_ID__c}&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(68, 68, 68); background-color: rgb(255, 255, 255);&quot;&gt;If you have questions, contact the Lab Team.&lt;/span&gt;&lt;/p&gt;</text>
    </textTemplates>
    <variables>
        <description>This is the passed in recordid for the baby record.</description>
        <name>varBabyRecordID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>This is the current value of the Get CT From Placenta Checkbox. This will allow us to know if we have sent the notification already.</description>
        <name>varBoolGetCTFromPlacentaCurrentValue</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Prior value of the Get CT from Placenta Checkbox. This will allow us to know if the value has changed.</description>
        <name>varBoolGetCTFromPlacentaPriorValue</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>This is the client services distro list.</description>
        <name>varTEmailAddressForClientServices</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>clients@americordblood.com, lab@americordblood.com</stringValue>
        </value>
    </variables>
    <variables>
        <description>Subject of the email to the CS Team.</description>
        <name>varTEmailSubject</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>Service Team - Lab Issue With CT Sample</stringValue>
        </value>
    </variables>
</Flow>
