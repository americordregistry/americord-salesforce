<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>57.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <decisions>
        <description>Determine if the contact has opted out of SMS</description>
        <name>Has_Contacted_Opted_Out_Of_SMS</name>
        <label>Has Contacted Opted Out Of SMS</label>
        <locationX>248</locationX>
        <locationY>1847</locationY>
        <defaultConnector>
            <targetReference>Should_we_Create_Portal_Authentication</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO - Has Not Opted Out</defaultConnectorLabel>
        <rules>
            <name>YES_Has_Opted_Out</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.tdc_tsw__SMS_Opt_out__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Opportunity__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Opportunity__r.IsClosed</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Opportunity_Opt_Out</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>YES - Has Opted Out</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determine if the mother information has changed.</description>
        <name>Has_Mother_Information_Changed</name>
        <label>Has Mother Information Changed</label>
        <locationX>248</locationX>
        <locationY>2747</locationY>
        <defaultConnectorLabel>NO - No Change</defaultConnectorLabel>
        <rules>
            <name>YES_Has_Changed</name>
            <conditionLogic>1 AND (2 OR 3 ) AND 4</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Mother</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.FirstName</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.LastName</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Portal_Authentication__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Portal_Auth_Record</targetReference>
            </connector>
            <label>YES - Has Changed</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determine if the surrogate information has changed</description>
        <name>Has_Surrogate_Information_Changed</name>
        <label>Has Surrogate Information Changed</label>
        <locationX>248</locationX>
        <locationY>2447</locationY>
        <defaultConnector>
            <targetReference>Has_Mother_Information_Changed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO - Surrogate Info Not Changed</defaultConnectorLabel>
        <rules>
            <name>YES_Surrogate_Info_Changed</name>
            <conditionLogic>1 AND (2 OR 3 OR 4)</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Surrogate</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.FirstName</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.LastName</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Email</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Lab_For_Changed_Surrogate_Info</targetReference>
            </connector>
            <label>YES - Surrogate Info Changed</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determine if the contact has been referred by.</description>
        <name>Is_Contact_Referred_By</name>
        <label>Is Contact Referred By</label>
        <locationX>248</locationX>
        <locationY>1439</locationY>
        <defaultConnector>
            <targetReference>Has_Contacted_Opted_Out_Of_SMS</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO - Not Referred</defaultConnectorLabel>
        <rules>
            <name>YES_Referred_By</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Referring_Contact__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.First_CBO__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Account.Commission_Created__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Commission_Record</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>YES - Referred By</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determine if the Create Opp/Lead is set on Contact</description>
        <name>Is_Create_Opp_Lead_Set</name>
        <label>Is Create Opp/Lead Set</label>
        <locationX>248</locationX>
        <locationY>323</locationY>
        <defaultConnector>
            <targetReference>myRule_1</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No - Its False</defaultConnectorLabel>
        <rules>
            <name>YES_It_Is_Set_To_True</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Create_New_Lead__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Opportunity</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>YES - It Is Set To True</label>
        </rules>
    </decisions>
    <decisions>
        <name>myRule_1</name>
        <label>Agreement is Created</label>
        <locationX>248</locationX>
        <locationY>731</locationY>
        <defaultConnector>
            <targetReference>myRule_3</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>FALSE_Agreement is Created</defaultConnectorLabel>
        <rules>
            <name>TRUE_myRule_1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Agreement_Status_Contact__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Created</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>myRule_1_A1</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>TRUE_Agreement is Created</label>
        </rules>
    </decisions>
    <decisions>
        <name>myRule_3</name>
        <label>Agreement is Signed</label>
        <locationX>446</locationX>
        <locationY>839</locationY>
        <defaultConnector>
            <targetReference>Is_Contact_Referred_By</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>FALSE_Agreement is Signed</defaultConnectorLabel>
        <rules>
            <name>TRUE_myRule_3</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Agreement_Status_Contact__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Signed / Returned</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>myRule_3_A1</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>TRUE_Agreement is Signed</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determine if we should create the portal authentication.</description>
        <name>Should_we_Create_Portal_Authentication</name>
        <label>Should we Create Portal Authentication</label>
        <locationX>248</locationX>
        <locationY>2147</locationY>
        <defaultConnector>
            <targetReference>Has_Surrogate_Information_Changed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO - Dont Create</defaultConnectorLabel>
        <rules>
            <name>YES_Create_Portal_Auth</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Create_Portal_Access__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Portal_Authentication__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Create_Portal_Authentication_for_Older_Orders</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>YES - Create Portal Auth</label>
        </rules>
    </decisions>
    <description>This is the main flow for contact insert/updates.</description>
    <environments>Default</environments>
    <formulas>
        <name>formula_1_myRule_3_A3_8449501823</name>
        <dataType>String</dataType>
        <expression>if (ispickval({!$Record.Account.Agreement_Type_Acct__c}, &quot;Practice&quot;),
&quot;Both&quot;, &quot;Individual&quot;)</expression>
    </formulas>
    <formulas>
        <name>formula_2_myRule_3_A1_3634995037</name>
        <dataType>Date</dataType>
        <expression>today ()</expression>
    </formulas>
    <interviewLabel>RecordTrigger:Contact After Insert Update {!$Flow.CurrentDateTime}</interviewLabel>
    <label>RecordTrigger:Contact After Insert Update</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <description>Create the commission record for the referral.</description>
        <name>Create_Commission_Record</name>
        <label>Create Commission Record</label>
        <locationX>116</locationX>
        <locationY>1547</locationY>
        <connector>
            <targetReference>Update_Account_Commission_Created</targetReference>
        </connector>
        <inputAssignments>
            <field>Commission_Amount__c</field>
            <value>
                <numberValue>100.0</numberValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Order__c</field>
            <value>
                <elementReference>$Record.First_CBO__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Referrer__c</field>
            <value>
                <elementReference>$Record.Referring_Contact__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Enrolled</stringValue>
            </value>
        </inputAssignments>
        <object>Commission__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordUpdates>
        <name>myRule_1_A1</name>
        <label>Individual Agreement Type</label>
        <locationX>50</locationX>
        <locationY>839</locationY>
        <connector>
            <targetReference>myRule_1_A2</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Agreement_Type_Acct__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Practice</stringValue>
            </value>
        </filters>
        <filters>
            <field>Agreement_Type_Acct__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Both</stringValue>
            </value>
        </filters>
        <filters>
            <field>Agreement_Type_Contact__pc</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Individual</stringValue>
            </value>
        </filters>
        <inputAssignments>
            <field>Agreement_Type_Acct__c</field>
            <value>
                <stringValue>Individual</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record.Account</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>myRule_3_A1</name>
        <label>Start Date</label>
        <locationX>314</locationX>
        <locationY>947</locationY>
        <connector>
            <targetReference>myRule_3_A2</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Agreement_Start_Date__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Territory__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <inputAssignments>
            <field>Agreement_Start_Date__c</field>
            <value>
                <elementReference>formula_2_myRule_3_A1_3634995037</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>myRule_3_A2</name>
        <label>Update Account</label>
        <locationX>314</locationX>
        <locationY>1055</locationY>
        <connector>
            <targetReference>myRule_3_A3</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>HCP_Agreement__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Signed / Returned</stringValue>
            </value>
        </filters>
        <filters>
            <field>Territory_Zip__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <inputAssignments>
            <field>HCP_Agreement__c</field>
            <value>
                <stringValue>Signed / Returned</stringValue>
            </value>
        </inputAssignments>
        <inputReference>$Record.Account</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>myRule_3_A3</name>
        <label>Update Agreement Type</label>
        <locationX>314</locationX>
        <locationY>1163</locationY>
        <connector>
            <targetReference>Is_Contact_Referred_By</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Agreement_Type_Acct__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Individual</stringValue>
            </value>
        </filters>
        <filters>
            <field>Agreement_Type_Acct__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Both</stringValue>
            </value>
        </filters>
        <filters>
            <field>Territory_Zip__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <inputAssignments>
            <field>Agreement_Type_Acct__c</field>
            <value>
                <elementReference>formula_1_myRule_3_A3_8449501823</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record.Account</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Update the account commission created to true.</description>
        <name>Update_Account_Commission_Created</name>
        <label>Update Account Commission Created</label>
        <locationX>116</locationX>
        <locationY>1655</locationY>
        <connector>
            <targetReference>Has_Contacted_Opted_Out_Of_SMS</targetReference>
        </connector>
        <inputAssignments>
            <field>Commission_Created__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputReference>$Record.Account</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Update the contact field create lead/opp to false.</description>
        <name>Update_Contact_Create_Lead_Opp_False</name>
        <label>Update Contact - Create Lead/Opp False</label>
        <locationX>116</locationX>
        <locationY>539</locationY>
        <connector>
            <targetReference>myRule_1</targetReference>
        </connector>
        <inputAssignments>
            <field>Create_New_Lead__c</field>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Update the Opportunity to Opted Out.</description>
        <name>Update_Opportunity_Opt_Out</name>
        <label>Update Opportunity Opt Out</label>
        <locationX>116</locationX>
        <locationY>1955</locationY>
        <connector>
            <targetReference>Should_we_Create_Portal_Authentication</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>tdc_tsw__SMS_Opt_out__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <inputAssignments>
            <field>tdc_tsw__SMS_Opt_out__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputReference>$Record.Opportunity__r</inputReference>
    </recordUpdates>
    <recordUpdates>
        <description>Update the Portal Auth Record with new mother info.</description>
        <name>Update_Portal_Auth_Record</name>
        <label>Update Portal Auth Record</label>
        <locationX>116</locationX>
        <locationY>2855</locationY>
        <inputAssignments>
            <field>First_Name__c</field>
            <value>
                <elementReference>$Record.FirstName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Last_Name__c</field>
            <value>
                <elementReference>$Record.LastName</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record.Portal_Authentication__r</inputReference>
    </recordUpdates>
    <start>
        <locationX>122</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Is_Create_Opp_Lead_Set</targetReference>
        </connector>
        <object>Contact</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <description>Call subflow to create opportunity if it doesnt exist.</description>
        <name>Create_Opportunity</name>
        <label>Create Opportunity</label>
        <locationX>116</locationX>
        <locationY>431</locationY>
        <connector>
            <targetReference>Update_Contact_Create_Lead_Opp_False</targetReference>
        </connector>
        <flowName>Contact_Lookup_Opportunity_if_no_Open_Opportunity_Create_New_Opportunity</flowName>
        <inputAssignments>
            <name>varContactID</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <description>Create Portal Auth</description>
        <name>Create_Portal_Authentication_for_Older_Orders</name>
        <label>Create Portal Authentication for Older Orders</label>
        <locationX>116</locationX>
        <locationY>2255</locationY>
        <connector>
            <targetReference>Has_Surrogate_Information_Changed</targetReference>
        </connector>
        <flowName>PA_for_Older_Orders</flowName>
        <inputAssignments>
            <name>ContactEmail</name>
            <value>
                <elementReference>$Record.Email</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>ContactID</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>mothersfirstname</name>
            <value>
                <elementReference>$Record.FirstName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>motherslastname</name>
            <value>
                <elementReference>$Record.LastName</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <subflows>
        <name>myRule_1_A2</name>
        <label>Add Attachment ID to Contact</label>
        <locationX>50</locationX>
        <locationY>947</locationY>
        <connector>
            <targetReference>Is_Contact_Referred_By</targetReference>
        </connector>
        <flowName>Contact_populate_HCP_Agreement_Attachment_ID</flowName>
        <inputAssignments>
            <name>varContactID</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <description>Update the lab record for the changed surrogate info.</description>
        <name>Update_Lab_For_Changed_Surrogate_Info</name>
        <label>Update Lab For Changed Surrogate Info</label>
        <locationX>116</locationX>
        <locationY>2555</locationY>
        <connector>
            <targetReference>Has_Mother_Information_Changed</targetReference>
        </connector>
        <flowName>Update_Lab_when_Surrogate_Contact_is_Updated</flowName>
        <inputAssignments>
            <name>varContactID</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varEmail</name>
            <value>
                <elementReference>$Record.Email</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varFirstName</name>
            <value>
                <elementReference>$Record.FirstName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varLabID</name>
            <value>
                <elementReference>$Record.Lab_ID__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varLastName</name>
            <value>
                <elementReference>$Record.LastName</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
</Flow>
