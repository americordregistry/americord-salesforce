<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>49.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <name>A1_Installment_RV</name>
        <label>A1 - Installment RV</label>
        <locationX>1144</locationX>
        <locationY>2616</locationY>
        <assignmentItems>
            <assignToReference>rvarInstallment.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInstallment.fw1__Installment_Amount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formInstallmentAmount</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInstallment.fw1__Installment_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formTodaysDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInstallment.fw1__Invoice__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_New_Invoice_Lines.fw1__Invoice__r.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>A2_Installment_CV</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>A1_Invoice_Line_RV</name>
        <label>A1 - Invoice Line RV</label>
        <locationX>880</locationX>
        <locationY>1308</locationY>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.Category__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>conCategory</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.Custom_Pricing__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formCustomPricing</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.Product_Code__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>conProductCode</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw1__Invoice__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_New_Orders.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw1__Quantity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_New_Orders.ASP_Quantity__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw1__Unit_Price__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarInvoice.Annual_Fee_Unit_Price__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw1__Discount_Amount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_New_Orders.Bundle_Savings_for_ASP__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw2__Product__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>conProduct</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw1__Price_Book__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_New_Orders.Price_Book__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>A2_Invoice_Line_CV</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>A1_Invoice_Line_RV_OB</name>
        <label>A1 - Invoice Line RV - OB</label>
        <locationX>616</locationX>
        <locationY>1908</locationY>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.Category__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>conCategory</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.Custom_Pricing__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formCustomPricing</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.Product_Code__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>conProductCode</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw1__Invoice__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_New_Orders.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw1__Quantity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw1__Unit_Price__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>forCurrInvoiceLineUnitPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw1__Discount_Amount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_New_Orders.Bundle_Savings_for_ASP__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw2__Product__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>conProduct</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoiceLine.fw1__Price_Book__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_New_Orders.Price_Book__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>A2_Invoice_Line_CV</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>A1_Order_RV</name>
        <label>A1 - Order RV</label>
        <locationX>264</locationX>
        <locationY>576</locationY>
        <assignmentItems>
            <assignToReference>rvarInvoice.Annual_Fee_Unit_Price__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Annual_Fee_Unit_Price__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Annual_Storage_Fee_Alt_Price__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Annual_Storage_Fee_Alt_Price__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Contact_2_ID__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Contact_2_ID__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Cord_Blood_Stored__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Cord_Blood_Stored__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Cord_Blood_2_0_Stored__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Cord_Blood_2_0_Stored__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Cord_Tissue_Stored__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Cord_Tissue_Stored__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Placenta_Tissue_Stored__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Placenta_Tissue_Stored__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Placenta_2_0_Stored__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Placenta_2_0_Stored__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Storage_Plan_Stored__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Storage_Plan_Stored__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Payment_Plan_Stored__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Payment_Plan_Stored__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Enroll_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Enroll_Date__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.fw1__Account__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.fw1__Account__r.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.fw1__Contact__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.fw1__Contact__r.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.fw1__Invoice_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formInvoiceDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.fw1__Payment_Plan__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Payment_Plans.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.fw1__Payment_Profile__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.fw1__Payment_Profile__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Lab__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Lab__r.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Parent_Order__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Number_of_Births__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Number_of_Births__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Price_Book__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Price_Book__r.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.RecordTypeId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>conRecordTypeID</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.fw1__Auto_BillPay__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>conAutoBill</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.ASP_Quantity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Number_of_Products_Stored__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInvoice.Bundle_Savings_for_ASP__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rvarSingleOrder4Loop.Bundle_Savings_for_ASP_V2__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>A2_Order_CV</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>A2_Installment_CV</name>
        <label>A2 - Installment CV</label>
        <locationX>858</locationX>
        <locationY>3600</locationY>
        <assignmentItems>
            <assignToReference>rcvInstallments</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>rvarInstallment</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_New_Invoice_Lines</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>A2_Invoice_Line_CV</name>
        <label>A2 - Invoice Line CV</label>
        <locationX>748</locationX>
        <locationY>2100</locationY>
        <assignmentItems>
            <assignToReference>rcvInvoiceLines2BCreated</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>rvarInvoiceLine</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_New_Orders</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>A2_Order_CV</name>
        <label>A2 - Order CV</label>
        <locationX>264</locationX>
        <locationY>684</locationY>
        <assignmentItems>
            <assignToReference>rcvInvoice</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>rvarInvoice</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Multiple_Orders</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Set discount based on the discount record found.</description>
        <name>Assign_Discount</name>
        <label>Assign Discount</label>
        <locationX>968</locationX>
        <locationY>3048</locationY>
        <assignmentItems>
            <assignToReference>varNumberAnnualDiscount</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Over_Annual_Discounts.Amount__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Over_Annual_Discounts</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Set discount based on the discount record found.</description>
        <name>Assign_Discount_Invoice_Line</name>
        <label>Assign Discount - Invoice Line</label>
        <locationX>704</locationX>
        <locationY>1632</locationY>
        <assignmentItems>
            <assignToReference>varNumberAnnualDiscount</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Over_Annual_DiscountsOB.Amount__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Over_Annual_DiscountsOB</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Initialize_Annual_Discount</name>
        <label>Initialize Annual Discount</label>
        <locationX>880</locationX>
        <locationY>2724</locationY>
        <assignmentItems>
            <assignToReference>varNumberAnnualDiscount</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCollTextInvoiceIds</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_New_Invoice_Lines.fw1__Invoice__r.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Over_Annual_Discounts</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Initialize variable for annual discount.</description>
        <name>Initialize_Annual_Discount_Inv_Lines</name>
        <label>Initialize Annual Discount - Inv Lines</label>
        <locationX>616</locationX>
        <locationY>1308</locationY>
        <assignmentItems>
            <assignToReference>varNumberAnnualDiscount</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>0.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Over_Annual_DiscountsOB</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Order_Builder_Installment_Record</name>
        <label>Order Builder - Installment Record</label>
        <locationX>880</locationX>
        <locationY>3324</locationY>
        <assignmentItems>
            <assignToReference>rvarInstallment.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInstallment.fw1__Installment_Amount__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formInstallmentAmountOB</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInstallment.fw1__Installment_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formTodaysDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>rvarInstallment.fw1__Invoice__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_New_Invoice_Lines.fw1__Invoice__r.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>A2_Installment_CV</targetReference>
        </connector>
    </assignments>
    <constants>
        <name>conAutoBill</name>
        <dataType>Boolean</dataType>
        <value>
            <booleanValue>true</booleanValue>
        </value>
    </constants>
    <constants>
        <name>conCategory</name>
        <dataType>String</dataType>
        <value>
            <stringValue>Storage</stringValue>
        </value>
    </constants>
    <constants>
        <name>conPaymentPlan</name>
        <dataType>String</dataType>
        <value>
            <stringValue>a1Y6f00000R2Wje</stringValue>
        </value>
    </constants>
    <constants>
        <name>conProduct</name>
        <dataType>String</dataType>
        <value>
            <stringValue>01t0B000003L65P</stringValue>
        </value>
    </constants>
    <constants>
        <name>conProductCode</name>
        <dataType>String</dataType>
        <value>
            <stringValue>ASP</stringValue>
        </value>
    </constants>
    <constants>
        <name>conRecordTypeID</name>
        <dataType>String</dataType>
        <value>
            <stringValue>0126f000001UXp7</stringValue>
        </value>
    </constants>
    <decisions>
        <description>Determine if the invoice has already been processed.</description>
        <name>Already_Processed_This_Invoice</name>
        <label>Already Processed This Invoice?</label>
        <locationX>572</locationX>
        <locationY>2616</locationY>
        <defaultConnector>
            <targetReference>Initialize_Annual_Discount</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO - Not Processed</defaultConnectorLabel>
        <rules>
            <name>YES_Processed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varCollTextInvoiceIds</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Loop_New_Invoice_Lines.fw1__Invoice__r.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <isGoTo>true</isGoTo>
                <targetReference>Loop_New_Invoice_Lines</targetReference>
            </connector>
            <label>YES -  Processed</label>
        </rules>
    </decisions>
    <decisions>
        <name>Does_Annual_Discount_Match_Service_Count</name>
        <label>Does Annual Discount Match Service Count</label>
        <locationX>1100</locationX>
        <locationY>2940</locationY>
        <defaultConnector>
            <targetReference>Loop_Over_Annual_Discounts</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO - Service Count Not Matched</defaultConnectorLabel>
        <rules>
            <name>YES_Service_Count_Found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_Over_Annual_Discounts.Services_Count__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Loop_New_Invoice_Lines.fw1__Invoice__r.Parent_Order__r.Number_of_Products__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Discount</targetReference>
            </connector>
            <label>YES - Service Count Found</label>
        </rules>
    </decisions>
    <decisions>
        <name>Does_Discount_Services_match_Number_of_Products</name>
        <label>Does Discount Services match Number of Products</label>
        <locationX>836</locationX>
        <locationY>1524</locationY>
        <defaultConnector>
            <targetReference>Loop_Over_Annual_DiscountsOB</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No - Counts Do Not Match</defaultConnectorLabel>
        <rules>
            <name>YES_Matched_Counts</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_Over_Annual_DiscountsOB.Services_Count__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Loop_New_Orders.Parent_Order__r.Number_of_Products__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Discount_Invoice_Line</targetReference>
            </connector>
            <label>YES - Matched Counts</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determine if this order was created before or after order builder.</description>
        <name>Is_OB_Annual_Order</name>
        <label>Is OB Annual Order</label>
        <locationX>858</locationX>
        <locationY>2508</locationY>
        <defaultConnector>
            <targetReference>A1_Installment_RV</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Not Order Builder Order</defaultConnectorLabel>
        <rules>
            <name>Order_Builder_Order</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_New_Invoice_Lines.fw1__Invoice__r.Parent_Order__r.Annual_Services_Total__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Already_Processed_This_Invoice</targetReference>
            </connector>
            <label>Order Builder Order</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determine if we are working on an invoice created with Order builder or older.</description>
        <name>Is_OB_Invoice</name>
        <label>Is OB Invoice?</label>
        <locationX>748</locationX>
        <locationY>1200</locationY>
        <defaultConnector>
            <targetReference>A1_Invoice_Line_RV</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO - Pre OB</defaultConnectorLabel>
        <rules>
            <name>YES_OB_Order</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Loop_New_Orders.Parent_Order__r.Annual_Services_Total__c</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Initialize_Annual_Discount_Inv_Lines</targetReference>
            </connector>
            <label>YES - OB Order</label>
        </rules>
    </decisions>
    <description>Automatically creates Invoice Lines and Installments each year if &quot;Stop Annual&quot; is not activated. It uses formula field on order to determine which Price Book and hence which Annual Storage Fee. it considers whether there is a custom price.</description>
    <environments>Default</environments>
    <formulas>
        <description>This is formula will compute the unit price for the invoice line of the annual order.</description>
        <name>forCurrInvoiceLineUnitPrice</name>
        <dataType>Currency</dataType>
        <expression>{!Loop_New_Orders.Parent_Order__r.Annual_Storage_Yearly__c}-{!varNumberAnnualDiscount}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <description>This formula will compute the unit price for the invoice lines.</description>
        <name>forCurrUnitPriceForOBInvLine</name>
        <dataType>Currency</dataType>
        <expression>{!Loop_New_Orders.Parent_Order__r.Annual_Storage_Yearly__c}-{!varNumberAnnualDiscount}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>formAnnualStorageFee</name>
        <dataType>Currency</dataType>
        <expression>if ({!rvarSingleOrder4Loop.Annual_Storage_Fee_Alt_Price__c}&gt;0,{!rvarSingleOrder4Loop.Annual_Storage_Fee_Alt_Price__c}, {!rvarSingleOrder4Loop.Annual_Fee_Unit_Price__c} )</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>formBundleSavings</name>
        <dataType>Currency</dataType>
        <expression>IF ( {!rvarSingleOrder4Loop.Numeric_Births__c} = 1 &amp;&amp; {!rvarSingleOrder4Loop.Price_Book__c} = &apos;01s0B000001AQHK&apos; &amp;&amp; ({!rvarSingleOrder4Loop.Annual_Storage_Fee_Alt_Price__c}=0 || isblank({!rvarSingleOrder4Loop.Annual_Storage_Fee_Alt_Price__c})),
CASE ({!rvarSingleOrder4Loop.Number_of_Products__c},
1,0,
2, 25,
3, 75,
0),
IF ( {!rvarSingleOrder4Loop.Numeric_Births__c} = 2 &amp;&amp; {!rvarSingleOrder4Loop.Price_Book__c} = &apos;01s0B000001AQHK&apos; &amp;&amp; ({!rvarSingleOrder4Loop.Annual_Storage_Fee_Alt_Price__c}=0 || isblank({!rvarSingleOrder4Loop.Annual_Storage_Fee_Alt_Price__c})),
CASE ({!rvarSingleOrder4Loop.Number_of_Products__c},
2,0,
3, 25,
4, 50,
5, 100,
6, 150,
0),
IF ( {!rvarSingleOrder4Loop.Numeric_Births__c} = 3 &amp;&amp; {!rvarSingleOrder4Loop.Price_Book__c} = &apos;01s0B000001AQHK&apos; &amp;&amp; ({!rvarSingleOrder4Loop.Annual_Storage_Fee_Alt_Price__c}=0 || isblank({!rvarSingleOrder4Loop.Annual_Storage_Fee_Alt_Price__c})),
CASE ({!rvarSingleOrder4Loop.Number_of_Products__c},
2,0,
3,0,
6, 75,
9, 225,
0),
0)))</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>formCustomPricing</name>
        <dataType>Boolean</dataType>
        <expression>if ({!rvarSingleOrder4Loop.Annual_Storage_Fee_Alt_Price__c}&gt;0,true, false)</expression>
    </formulas>
    <formulas>
        <name>formInstallmentAmount</name>
        <dataType>Currency</dataType>
        <expression>{!Loop_New_Invoice_Lines.fw1__Invoice__r.Parent_Order__r.Annual_Storage_Yearly__c}-{!Loop_New_Invoice_Lines.fw1__Discount_Amount__c}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <description>This formula will compute the installment amount for the Annual OB orders.</description>
        <name>formInstallmentAmountOB</name>
        <dataType>Currency</dataType>
        <expression>{!Loop_New_Invoice_Lines.fw1__Invoice__r.Parent_Order__r.Annual_Storage_Yearly__c}-{!varNumberAnnualDiscount}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>formInvoiceDate</name>
        <dataType>Date</dataType>
        <expression>ADDMONTHS ({!rvarSingleOrder4Loop.fw1__Invoice_Date__c}, {!formNumberofyears} * 12)</expression>
    </formulas>
    <formulas>
        <name>formName</name>
        <dataType>String</dataType>
        <expression>&apos;Annual Fee -  &apos;+TEXT((Year({!$Flow.CurrentDate})))</expression>
    </formulas>
    <formulas>
        <name>formNumberofyears</name>
        <dataType>Number</dataType>
        <expression>Year(today())- Year({!rvarSingleOrder4Loop.fw1__Invoice_Date__c})</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <name>formTodaysDate</name>
        <dataType>Date</dataType>
        <expression>today()</expression>
    </formulas>
    <interviewLabel>Order Annual Storage Plan Create Invoice Lines and Installments Each Year {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Order Annual Storage Plan Create Invoice Lines and Installments Each Year</label>
    <loops>
        <name>Loop_Multiple_Orders</name>
        <label>Loop Multiple Orders</label>
        <locationX>176</locationX>
        <locationY>468</locationY>
        <assignNextValueToReference>rvarSingleOrder4Loop</assignNextValueToReference>
        <collectionReference>Get_Orders_with_Annual_Payment_Due_Today</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>A1_Order_RV</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_Orders</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_New_Invoice_Lines</name>
        <label>Loop New Invoice Lines</label>
        <locationX>176</locationX>
        <locationY>2400</locationY>
        <collectionReference>rcvInvoiceLines2BCreated</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Is_OB_Annual_Order</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_Installment</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_New_Orders</name>
        <label>Loop New Orders</label>
        <locationX>176</locationX>
        <locationY>1092</locationY>
        <collectionReference>rcvInvoice</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Is_OB_Invoice</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_Invoice_Line</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Over_Annual_Discounts</name>
        <label>Loop Over Annual Discounts</label>
        <locationX>880</locationX>
        <locationY>2832</locationY>
        <collectionReference>recDiscountsAnnual</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Does_Annual_Discount_Match_Service_Count</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Order_Builder_Installment_Record</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Over_Annual_DiscountsOB</name>
        <label>Loop Over Annual Discounts</label>
        <locationX>616</locationX>
        <locationY>1416</locationY>
        <collectionReference>recDiscountsAnnual</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Does_Discount_Services_match_Number_of_Products</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>A1_Invoice_Line_RV_OB</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Installment</name>
        <label>Create Installment</label>
        <locationX>176</locationX>
        <locationY>3792</locationY>
        <inputReference>rcvInstallments</inputReference>
    </recordCreates>
    <recordCreates>
        <name>Create_Invoice_Line</name>
        <label>Create Invoice Line</label>
        <locationX>176</locationX>
        <locationY>2292</locationY>
        <connector>
            <targetReference>Loop_New_Invoice_Lines</targetReference>
        </connector>
        <inputReference>rcvInvoiceLines2BCreated</inputReference>
    </recordCreates>
    <recordCreates>
        <name>Create_Orders</name>
        <label>Create Orders</label>
        <locationX>176</locationX>
        <locationY>876</locationY>
        <connector>
            <targetReference>Get_Annual_Discount_Records</targetReference>
        </connector>
        <inputReference>rcvInvoice</inputReference>
    </recordCreates>
    <recordLookups>
        <description>Get the annual discount records that we will use the installment loop</description>
        <name>Get_Annual_Discount_Records</name>
        <label>Get Annual Discount Records</label>
        <locationX>176</locationX>
        <locationY>984</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_New_Orders</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Applicable_Storage_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>ASP</stringValue>
            </value>
        </filters>
        <filters>
            <field>Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Multi-Annual Storage</stringValue>
            </value>
        </filters>
        <object>Discount__c</object>
        <outputReference>recDiscountsAnnual</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Amount__c</queriedFields>
        <queriedFields>Services_Count__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Orders_with_Annual_Payment_Due_Today</name>
        <label>Get Orders with Annual Payment Due Today</label>
        <locationX>176</locationX>
        <locationY>252</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Payment_Plans</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>fw1__Invoice__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Annual_Fee_Unit_Price__c</queriedFields>
        <queriedFields>Number_of_Products_Stored__c</queriedFields>
        <queriedFields>Annual_Storage_Fee_Alt_Price__c</queriedFields>
        <queriedFields>Numeric_Births__c</queriedFields>
        <queriedFields>fw1__Invoice_Date__c</queriedFields>
        <queriedFields>Contact_2_ID__c</queriedFields>
        <queriedFields>Cord_Blood_Stored__c</queriedFields>
        <queriedFields>Cord_Blood_2_0_Stored__c</queriedFields>
        <queriedFields>Cord_Tissue_Stored__c</queriedFields>
        <queriedFields>Placenta_Tissue_Stored__c</queriedFields>
        <queriedFields>Placenta_2_0_Stored__c</queriedFields>
        <queriedFields>Storage_Plan_Stored__c</queriedFields>
        <queriedFields>Payment_Plan_Stored__c</queriedFields>
        <queriedFields>Enroll_Date__c</queriedFields>
        <queriedFields>fw1__Account__c</queriedFields>
        <queriedFields>fw1__Contact__c</queriedFields>
        <queriedFields>fw1__Payment_Profile__c</queriedFields>
        <queriedFields>Lab__c</queriedFields>
        <queriedFields>Number_of_Births__c</queriedFields>
        <queriedFields>Price_Book__c</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>Bundle_Savings_for_ASP_V2__c</queriedFields>
        <queriedFields>Annual_Services_Total__c</queriedFields>
        <sortField>Id</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the Annual Payment plan - prevents having to hardcode ids.</description>
        <name>Get_Payment_Plans</name>
        <label>Get Payment Plans</label>
        <locationX>176</locationX>
        <locationY>360</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Multiple_Orders</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Name</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Annual Storage</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>fw1__Payment_Plan__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Orders_with_Annual_Payment_Due_Today</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Annual_Storage_Due_Today__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>fw1__Invoice__c</object>
        <schedule>
            <frequency>Daily</frequency>
            <startDate>2025-10-22</startDate>
            <startTime>00:05:00.000Z</startTime>
        </schedule>
        <triggerType>Scheduled</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <name>rcvInstallments</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>fw1__Installment__c</objectType>
    </variables>
    <variables>
        <name>rcvInvoice</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>fw1__Invoice__c</objectType>
    </variables>
    <variables>
        <name>rcvInvoiceLines2BCreated</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>fw1__Invoice_Line__c</objectType>
    </variables>
    <variables>
        <description>This variable will hold the collection of records of the Discount for annual.</description>
        <name>recDiscountsAnnual</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Discount__c</objectType>
    </variables>
    <variables>
        <name>rvarInstallment</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>fw1__Installment__c</objectType>
    </variables>
    <variables>
        <name>rvarInvoice</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>fw1__Invoice__c</objectType>
    </variables>
    <variables>
        <name>rvarInvoiceLine</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>fw1__Invoice_Line__c</objectType>
    </variables>
    <variables>
        <name>rvarSingleOrder4Loop</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>fw1__Invoice__c</objectType>
    </variables>
    <variables>
        <name>varAltPrice</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <description>Variable that will hold a collection of Invoice IDs.</description>
        <name>varCollTextInvoiceIds</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varInvoiceLineAmountforInstallment</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <description>Variable that will hold the annual discount lookup</description>
        <name>varNumberAnnualDiscount</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>varNumbericBirthsV2</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>varNumberofProducts</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>varPriceBook</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
