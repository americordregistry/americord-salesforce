<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <actionCalls>
        <description>This action will open the new record we created.</description>
        <name>Open_Opportunity_Record</name>
        <label>Open Opportunity Record</label>
        <locationX>666</locationX>
        <locationY>2678</locationY>
        <actionName>c:OpenRecord</actionName>
        <actionType>component</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>recordId</name>
            <value>
                <elementReference>Create_new_opportunity</elementReference>
            </value>
        </inputParameters>
        <nameSegment>c:OpenRecord</nameSegment>
        <offset>0</offset>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <apiVersion>56.0</apiVersion>
    <areMetricsLoggedToDataCloud>false</areMetricsLoggedToDataCloud>
    <assignments>
        <description>Assign counter values to be used by formulas in pricing.</description>
        <name>Assign_Counter_Values</name>
        <label>Assign Counter Values</label>
        <locationX>754</locationX>
        <locationY>1970</locationY>
        <assignmentItems>
            <assignToReference>varNumberCurrentOppProductCount</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Build_Opp_Product_Record_from_PBE</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>This will create the listing of excluded productcodes.</description>
        <name>Assign_ProductCodes_To_Exclude</name>
        <label>Assign ProductCodes To Exclude</label>
        <locationX>358</locationX>
        <locationY>350</locationY>
        <assignmentItems>
            <assignToReference>varTExcludeProductCodes</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>CollKit</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varTExcludeProductCodes</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>RushShip</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varTExcludeProductCodes</assignToReference>
            <operator>Add</operator>
            <value>
                <stringValue>StndShip</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Upgrade_Storage_Length</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Single_Record_to_Collection_of_Opp_Products</name>
        <label>Assign Single Record to Collection of Opp Products</label>
        <locationX>754</locationX>
        <locationY>2186</locationY>
        <assignmentItems>
            <assignToReference>varRecCollectionOppProduct</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>varRecOppProduct</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_over_PBE</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Set variables before we create the opp.</description>
        <name>Assign_Upgrade_Opp_Values_To_Variables</name>
        <label>Assign Upgrade Opp Values To Variables</label>
        <locationX>666</locationX>
        <locationY>1322</locationY>
        <assignmentItems>
            <assignToReference>varTOwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formTUserID18</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Order_Lifetime_Upgrade</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Build the opp product record (single).</description>
        <name>Build_Opp_Product_Record_from_PBE</name>
        <label>Build Opp Product Record from PBE</label>
        <locationX>754</locationX>
        <locationY>2078</locationY>
        <assignmentItems>
            <assignToReference>varRecOppProduct.OpportunityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Create_new_opportunity</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRecOppProduct.Quantity</assignToReference>
            <operator>Assign</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRecOppProduct.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_over_PBE.Name</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRecOppProduct.PricebookEntryId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_over_PBE.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRecOppProduct.UnitPrice</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>formCurrencyOppLineItemTotalPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCurrencyRunningOppProductTotal</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>formCurrencyOppLineItemTotalPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRecOppProduct.ListPrice</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_over_PBE.UnitPrice</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varRecOppProduct.Partial_Amount_Due_At_Checkout__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Single_Record_to_Collection_of_Opp_Products</targetReference>
        </connector>
    </assignments>
    <choices>
        <description>20 Year Storage</description>
        <name>choiceStorageLength_20Y</name>
        <choiceText>20yr</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>20yr</stringValue>
        </value>
    </choices>
    <choices>
        <description>Lifetime storage.</description>
        <name>choiceStorageLength_LT</name>
        <choiceText>Lifetime</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Lifetime</stringValue>
        </value>
    </choices>
    <choices>
        <description>This choice set is for deciding if we are working on an upgrade for Newer or Older orders/Invoice.</description>
        <name>choiceUpgradeForNewer</name>
        <choiceText>Newer (Existing Opp and Invoice)</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Newer</stringValue>
        </value>
    </choices>
    <choices>
        <description>This choice will be for Older invoices/orders without an opportunity.</description>
        <name>choiceUpgradeForOlder</name>
        <choiceText>Older (Opportunity does not exist)</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Older</stringValue>
        </value>
    </choices>
    <constants>
        <description>Lead source for the new opportunity.</description>
        <name>constTLeadSource</name>
        <dataType>String</dataType>
        <value>
            <stringValue>Lifetime Upgrade EC</stringValue>
        </value>
    </constants>
    <constants>
        <description>This is the new opportunity&apos;s stage.</description>
        <name>constTNewOppStage</name>
        <dataType>String</dataType>
        <value>
            <stringValue>New</stringValue>
        </value>
    </constants>
    <constants>
        <description>Storage plan for the new opp.</description>
        <name>constTStoragePlan</name>
        <dataType>String</dataType>
        <value>
            <stringValue>LTS</stringValue>
        </value>
    </constants>
    <decisions>
        <description>Check to see if we found the invoice.</description>
        <name>Did_We_Find_The_Invoice</name>
        <label>Did We Find The Invoice?</label>
        <locationX>358</locationX>
        <locationY>1106</locationY>
        <defaultConnector>
            <targetReference>Get_Active_Users</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>YES - Found Record</defaultConnectorLabel>
        <rules>
            <name>NO_Invoice_Not_Found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetOriginalOrder.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Upgrade_Could_Not_Find_Order</targetReference>
            </connector>
            <label>NO - Invoice Not Found</label>
        </rules>
    </decisions>
    <decisions>
        <name>Is_ID_Matching_Selected_Pricebook_Entry_ID</name>
        <label>Is ID Matching Selected Pricebook Entry ID</label>
        <locationX>886</locationX>
        <locationY>1862</locationY>
        <defaultConnector>
            <targetReference>Loop_over_PBE</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>NO - Not Matching PBE</defaultConnectorLabel>
        <rules>
            <name>YES_Match_PBE</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Select_Product_Services_For_New_Opportunity_Checkbox</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>Loop_over_PBE.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Assign_Counter_Values</targetReference>
            </connector>
            <label>YES - Match PBE</label>
        </rules>
    </decisions>
    <description>This is part 1 of 2 for the Lifetime upgrade process. This flow will create the Lifetime Opportunity.</description>
    <dynamicChoiceSets>
        <description>This collection choice will hold the list of active users in the system.</description>
        <name>collActiveUsers</name>
        <collectionReference>Get_Active_Users</collectionReference>
        <dataType>String</dataType>
        <displayField>Name</displayField>
        <object>User</object>
        <valueField>Id</valueField>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <description>collection choice of the services</description>
        <name>collChoiceSetUpgradeProducts</name>
        <collectionReference>Pricebook_Entries</collectionReference>
        <dataType>String</dataType>
        <displayField>Name</displayField>
        <object>PricebookEntry</object>
        <valueField>Id</valueField>
    </dynamicChoiceSets>
    <dynamicChoiceSets>
        <description>This are the available payment plans.</description>
        <name>PaymentPlan</name>
        <dataType>Picklist</dataType>
        <displayField xsi:nil="true"/>
        <object xsi:nil="true"/>
        <picklistField>Payment_Plans__c</picklistField>
        <picklistObject>Opportunity</picklistObject>
    </dynamicChoiceSets>
    <environments>Default</environments>
    <formulas>
        <description>This formula will validate that a value greater than zero has been entered for the upgrade.</description>
        <name>formBooleanUpgradeAmountValidation</name>
        <dataType>Boolean</dataType>
        <expression>IF({!Upgrade_Price} &lt;= 0,FALSE,TRUE)</expression>
    </formulas>
    <formulas>
        <description>This formula will compute the total price for each opportunity line item.</description>
        <name>formCurrencyOppLineItemTotalPrice</name>
        <dataType>Currency</dataType>
        <expression>IF({!varNumberCurrentOppProductCount}!= {!Call_Parsing_Subflow_For_Checklist_Values.varNumberOfElementsOutput},ROUND({!Upgrade_Price}/{!Call_Parsing_Subflow_For_Checklist_Values.varNumberOfElementsOutput},2),ABS(ROUND({!Upgrade_Price}/{!Call_Parsing_Subflow_For_Checklist_Values.varNumberOfElementsOutput},2)-({!Upgrade_Price}-{!varCurrencyRunningOppProductTotal}+{!Upgrade_Price}/{!Call_Parsing_Subflow_For_Checklist_Values.varNumberOfElementsOutput})))</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <description>Formula that will set the deposit for the opportunity product</description>
        <name>formCurrUpgradeDeposit</name>
        <dataType>Currency</dataType>
        <expression>IF({!varNumberCurrentOppProductCount}=1, {!Upgrade_Deposit}, null)</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <description>This formula will increment the number of opp products</description>
        <name>formNumberOpportunityProductIncrement</name>
        <dataType>Number</dataType>
        <expression>{!varNumberOfOppProductRecords}+1</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <description>This is the formula for the opp name on older orders.</description>
        <name>formTNewOppNameOlder</name>
        <dataType>String</dataType>
        <expression>{!GetOriginalOrder.fw1__Account__r.Name}+&quot; - &quot;+{!Storage_Upgrade_Length}+&quot; Upsell - &quot;+TEXT(YEAR({!GetOriginalOrder.Baby_s_Due_Date__c}))</expression>
    </formulas>
    <formulas>
        <description>Formula that will display todays date</description>
        <name>formTodaysDate</name>
        <dataType>Date</dataType>
        <expression>TODAY()</expression>
    </formulas>
    <formulas>
        <description>This formula will provide the storage plan API based on what was selected from the storage length choice.</description>
        <name>formTStoragePlan</name>
        <dataType>String</dataType>
        <expression>IF ({!Storage_Upgrade_Length} = &apos;Lifetime&apos;,&apos;LTS&apos;,&apos;20YPP&apos;)</expression>
    </formulas>
    <formulas>
        <description>This formula will convert the current user.ID value to the 18 char length.</description>
        <name>formTUserID18</name>
        <dataType>String</dataType>
        <expression>CASESAFEID({!$User.Id})</expression>
    </formulas>
    <interviewLabel>ScreenFlow: Opportunity Lifetime Upgrade {!$Flow.CurrentDateTime}</interviewLabel>
    <label>ScreenFlow: Opportunity Lifetime Upgrade</label>
    <loops>
        <name>Loop_over_PBE</name>
        <label>Loop over PBE</label>
        <locationX>666</locationX>
        <locationY>1754</locationY>
        <collectionReference>Pricebook_Entries</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Is_ID_Matching_Selected_Pricebook_Entry_ID</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Create_Opp_Products</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <description>Create the new opportunity for the lifetime upgrade.</description>
        <name>Create_new_opportunity</name>
        <label>Create new opportunity</label>
        <locationX>666</locationX>
        <locationY>1538</locationY>
        <connector>
            <targetReference>Call_Parsing_Subflow_For_Checklist_Values</targetReference>
        </connector>
        <inputAssignments>
            <field>AccountId</field>
            <value>
                <elementReference>GetOriginalOrder.fw1__Account__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Alt_Email_Address__c</field>
            <value>
                <elementReference>GetOriginalOrder.fw1__Contact__r.Alt_Email__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>CloseDate</field>
            <value>
                <elementReference>formTodaysDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact2_Email__c</field>
            <value>
                <elementReference>GetOriginalOrder.Contact_2__r.Email</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact2_FirstName__c</field>
            <value>
                <elementReference>GetOriginalOrder.Contact_2__r.FirstName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact2_LastName__c</field>
            <value>
                <elementReference>GetOriginalOrder.Contact_2__r.LastName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact2_Phone__c</field>
            <value>
                <elementReference>GetOriginalOrder.Contact_2_Phone__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact2_Relation_to_Baby__c</field>
            <value>
                <elementReference>GetOriginalOrder.Contact_2__r.Type__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact2__c</field>
            <value>
                <elementReference>GetOriginalOrder.Contact_2__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Contact__c</field>
            <value>
                <elementReference>GetOriginalOrder.fw1__Contact__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Email__c</field>
            <value>
                <elementReference>GetOriginalOrder.fw1__Contact__r.Email</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>FirstName__c</field>
            <value>
                <elementReference>GetOriginalOrder.fw1__Contact__r.FirstName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>LastName__c</field>
            <value>
                <elementReference>GetOriginalOrder.fw1__Contact__r.LastName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>LeadSource</field>
            <value>
                <elementReference>constTLeadSource</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Name</field>
            <value>
                <elementReference>formTNewOppNameOlder</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Original_Order__c</field>
            <value>
                <elementReference>GetOriginalOrder.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <elementReference>Opportunity_Owner.selectedChoiceValues</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Phone__c</field>
            <value>
                <elementReference>GetOriginalOrder.Contact_1_Phone__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Price_with_Sales_Discount_new__c</field>
            <value>
                <elementReference>Upgrade_Price</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>GetOppUpgradeRecordtype.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Relation_to_Baby__c</field>
            <value>
                <elementReference>GetOriginalOrder.Relation_to_Baby__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Shipping_Type__c</field>
            <value>
                <stringValue></stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>StageName</field>
            <value>
                <elementReference>constTNewOppStage</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Storage_Plan__c</field>
            <value>
                <elementReference>formTStoragePlan</elementReference>
            </value>
        </inputAssignments>
        <object>Opportunity</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <description>Create opp products from the list of opp products</description>
        <name>Create_Opp_Products</name>
        <label>Create Opp Products</label>
        <locationX>666</locationX>
        <locationY>2462</locationY>
        <connector>
            <targetReference>Opportunity_Created</targetReference>
        </connector>
        <inputReference>varRecCollectionOppProduct</inputReference>
    </recordCreates>
    <recordLookups>
        <description>This will get the list of active users.</description>
        <name>Get_Active_Users</name>
        <label>Get Active Users</label>
        <locationX>666</locationX>
        <locationY>1214</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assign_Upgrade_Opp_Values_To_Variables</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>User</object>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the default pricebook to use to lookup the correct products.</description>
        <name>Get_Default_Pricebook</name>
        <label>Get Default Pricebook</label>
        <locationX>358</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Assign_ProductCodes_To_Exclude</targetReference>
        </connector>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Americord_Settings__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the current Invoice if it exists for this opportunity id.</description>
        <name>GetCurrentInvoice</name>
        <label>GetCurrentInvoice</label>
        <locationX>358</locationX>
        <locationY>134</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_Default_Pricebook</targetReference>
        </connector>
        <filterLogic>or</filterLogic>
        <filters>
            <field>fw1__Opportunity__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <filters>
            <field>fw2__Opportunity__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>fw1__Invoice__c</object>
        <sortField>CreatedDate</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the CBO recordtypeid for the Upgrade RT.</description>
        <name>GetInvoiceUpgradeRecordtype</name>
        <label>GetInvoiceUpgradeRecordtype</label>
        <locationX>358</locationX>
        <locationY>782</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>GetOppUpgradeRecordtype</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>SobjectType</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>fw1__Invoice__c</stringValue>
            </value>
        </filters>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Upgrade</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>RecordType</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the Opp recordtypeid for the Upgrade RT.</description>
        <name>GetOppUpgradeRecordtype</name>
        <label>GetOppUpgradeRecordtype</label>
        <locationX>358</locationX>
        <locationY>890</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>GetOriginalOrder</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>SobjectType</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Opportunity</stringValue>
            </value>
        </filters>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Upgrade</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>RecordType</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Get the original CBO/Invoice associated with the entered name.</description>
        <name>GetOriginalOrder</name>
        <label>GetOriginalOrder</label>
        <locationX>358</locationX>
        <locationY>998</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Did_We_Find_The_Invoice</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Name</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Original_Invoice_Name</elementReference>
            </value>
        </filters>
        <filters>
            <field>RecordTypeId</field>
            <operator>NotEqualTo</operator>
            <value>
                <elementReference>GetInvoiceUpgradeRecordtype.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>fw1__Invoice__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>This will get the pricebook entries to be used for selection.</description>
        <name>Pricebook_Entries</name>
        <label>Pricebook Entries</label>
        <locationX>358</locationX>
        <locationY>566</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Enter_Original_Order_Information</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Pricebook2Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Default_Pricebook.Current_Price_Book__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>IsActive</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>ProductCode</field>
            <operator>NotIn</operator>
            <value>
                <elementReference>varTExcludeProductCodes</elementReference>
            </value>
        </filters>
        <filters>
            <field>Name</field>
            <operator>Contains</operator>
            <value>
                <elementReference>Storage_Upgrade_Length</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>PricebookEntry</object>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <screens>
        <description>Gather information about the original order/invoice.</description>
        <name>Enter_Original_Order_Information</name>
        <label>Enter Original Order Information</label>
        <locationX>358</locationX>
        <locationY>674</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>GetInvoiceUpgradeRecordtype</targetReference>
        </connector>
        <fields>
            <name>GatherInformationAboutOriginalOrder</name>
            <fieldText>&lt;p&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;We found the original order/invoice below. You can type &lt;/span&gt;&lt;u style=&quot;font-size: 14px;&quot;&gt;any&lt;/u&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt; order/invoice name in the box below and we will use that for the upgrade.&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Original_Invoice_Name</name>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>GetCurrentInvoice.Name</elementReference>
            </defaultValue>
            <fieldText>Original Invoice Name</fieldText>
            <fieldType>InputField</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>false</isRequired>
        </fields>
        <fields>
            <name>ProductsServicesSelectionPrompt</name>
            <fieldText>&lt;p&gt;&lt;span style=&quot;color: rgb(68, 68, 68); font-size: 14px; background-color: rgb(255, 255, 255);&quot;&gt;Select the product(s) you want on the upgrade opportunity below.&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Select_Product_Services_For_New_Opportunity_Checkbox</name>
            <choiceReferences>collChoiceSetUpgradeProducts</choiceReferences>
            <dataType>String</dataType>
            <fieldText>Select Product/Services For New Opportunity</fieldText>
            <fieldType>MultiSelectCheckboxes</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Opportunity_Created</name>
        <label>Opportunity Created</label>
        <locationX>666</locationX>
        <locationY>2570</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Open_Opportunity_Record</targetReference>
        </connector>
        <fields>
            <name>OlderOrderConfirmation</name>
            <fieldText>&lt;p&gt;Lifetime Upgrade Opportunity created for order. When you click next you will be taken to the new Opportunity where you can configure prices and payment plans using the Order Builder. &lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Order_Lifetime_Upgrade</name>
        <label>Order Lifetime Upgrade</label>
        <locationX>666</locationX>
        <locationY>1430</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Create_new_opportunity</targetReference>
        </connector>
        <fields>
            <name>Copy_1_of_Intro</name>
            <fieldText>&lt;p&gt;This process will create a lifetime upgrade for an opportunity&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Copy_1_of_NewOpportunityName</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;New Opportunity Name: &lt;/strong&gt;{!formTNewOppNameOlder}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Copy_1_of_NewOpportunityStage</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Stage: &lt;/strong&gt;{!constTNewOppStage}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Copy_1_of_PrimaryContact</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Primary Contact:  &lt;/strong&gt;{!GetOriginalOrder.fw1__Contact__r.FirstName} &lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;{!GetOriginalOrder.fw1__Contact__r.LastName}&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Copy_1_of_SecondaryContact</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Secondary Contact: &lt;/strong&gt;{!GetOriginalOrder.Contact_2__r.FirstName} &lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;{!GetOriginalOrder.Contact_2__r.LastName}&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Copy_1_of_NewOppAccount</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Account:&lt;/strong&gt; {!GetOriginalOrder.fw1__Account__r.Name}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>OlderStoragePlan</name>
            <fieldText>&lt;p&gt;&lt;strong&gt;Storage Plan: &lt;/strong&gt;{!constTStoragePlan}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Copy_1_of_CurrentServicesSelected</name>
            <fieldText>&lt;p&gt;&lt;strong style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;Here are the products/services we will add to Opportunity: &lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(68, 68, 68);&quot;&gt;{!Select_Product_Services_For_New_Opportunity_Checkbox}&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>Opportunity_Owner</name>
            <choiceReferences>collActiveUsers</choiceReferences>
            <defaultValue>
                <elementReference>varTOwnerId</elementReference>
            </defaultValue>
            <extensionName>flowruntime:choiceLookup</extensionName>
            <fieldText>Opportunity Owner (You may not have rights to change Opportunity Owners)</fieldText>
            <fieldType>ComponentChoice</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <storeOutputAutomatically>true</storeOutputAutomatically>
        </fields>
        <fields>
            <name>Upgrade_Price</name>
            <dataType>Currency</dataType>
            <defaultValue>
                <numberValue>0.0</numberValue>
            </defaultValue>
            <fieldText>Upgrade Price</fieldText>
            <fieldType>InputField</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <scale>0</scale>
            <validationRule>
                <errorMessage>&lt;p&gt;You must enter an Upgrade Price value.&lt;/p&gt;</errorMessage>
                <formulaExpression>{!formBooleanUpgradeAmountValidation}</formulaExpression>
            </validationRule>
        </fields>
        <fields>
            <name>Upgrade_Deposit</name>
            <dataType>Currency</dataType>
            <fieldText>Upgrade Deposit</fieldText>
            <fieldType>InputField</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <scale>0</scale>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>Upgrade_Could_Not_Find_Order</name>
        <label>Upgrade - Could Not Find Order</label>
        <locationX>50</locationX>
        <locationY>1214</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>Enter_Original_Order_Information</targetReference>
        </connector>
        <fields>
            <name>MessageCouldNotFindOrder</name>
            <fieldText>&lt;p&gt;We could not find an order/invoice for the entered value: {!Original_Invoice_Name}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <description>Screen to allow user to pick if we are upgrading to Lifetime or 20 Year</description>
        <name>Upgrade_Storage_Length</name>
        <label>Upgrade Storage Length</label>
        <locationX>358</locationX>
        <locationY>458</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Pricebook_Entries</targetReference>
        </connector>
        <fields>
            <name>Storage_Upgrade_Length</name>
            <choiceReferences>choiceStorageLength_LT</choiceReferences>
            <choiceReferences>choiceStorageLength_20Y</choiceReferences>
            <dataType>String</dataType>
            <defaultSelectedChoiceReference>choiceStorageLength_LT</defaultSelectedChoiceReference>
            <fieldText>Storage Upgrade Length</fieldText>
            <fieldType>RadioButtons</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>false</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>232</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>GetCurrentInvoice</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <description>This subflow will return a list of values from a delimited string of values.</description>
        <name>Call_Parsing_Subflow_For_Checklist_Values</name>
        <label>Call Parsing Subflow For Checklist Values</label>
        <locationX>666</locationX>
        <locationY>1646</locationY>
        <connector>
            <targetReference>Loop_over_PBE</targetReference>
        </connector>
        <flowName>Utility_ParsingMultiSelectValues</flowName>
        <inputAssignments>
            <name>varTextInputIdString</name>
            <value>
                <elementReference>Select_Product_Services_For_New_Opportunity_Checkbox</elementReference>
            </value>
        </inputAssignments>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </subflows>
    <variables>
        <name>currentItem_Filter_to_Selected_Pricebook_Entries</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>PricebookEntry</objectType>
    </variables>
    <variables>
        <description>This variable will hold the list of opp products to create</description>
        <name>recListOfOpportunityProducts</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <description>This is the opportunity product record for LT.</description>
        <name>recOpportunityProductRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <description>Opportunity Record Id to be used for the upgrade.</description>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>This is the running total for the opp product total price.</description>
        <name>varCurrencyOppProductRunningTotal</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <description>This variable will hold the running total of opp products.</description>
        <name>varCurrencyRunningOppProductTotal</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <description>Variable that will hold the Record Id from the lookup for invoice.</description>
        <name>varLookupRecordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Variable that will hold the current loop counter.</description>
        <name>varNumberCurrentOppLoopCounter</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <description>This variable will hold the current count of the opp product.</description>
        <name>varNumberCurrentOppProductCount</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <description>This is the running total of opportunity product records we have</description>
        <name>varNumberOfOppProductRecords</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>varRecCollectionOppProduct</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <description>variable that will hold the single opp product</description>
        <name>varRecOppProduct</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>OpportunityLineItem</objectType>
    </variables>
    <variables>
        <description>This variable will exclude product codes from the picklist.</description>
        <name>varTExcludeProductCodes</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Variable to hold the value for the owner id.</description>
        <name>varTOwnerId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>This will be the selected Product Id for the selected storage product.</description>
        <name>varTSelectedStorageProductId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
